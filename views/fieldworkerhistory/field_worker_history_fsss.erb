<%= erb :menu, locals: {pageid: 'home'} %>
<% require 'date' %>

<% job_role_active_check = field_worker_job_roles %>
<% job_role_active_check.each do |is_active| %>
  <% if is_active['active'] == false %>
    <% @is_active_present = false %>
    <% break %>
  <% else %>
    <% @is_active_present = true %>
  <% end %>
<% end %>

<% if field_worker_history_table.any?%>
  History for Field Worker
  <table class="primary">
    <thead>
    <tr>
      <% if field_worker_history_table[0].has_key?('ingestDate') %>
        <th>Ingest Date</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('uniqueEmployeeId') %>
        <th>Employee ID</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('firstName') %>
        <th>First Name</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('preferredName') %>
        <th>Preferred Name</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('surname') %>
        <th>Surname</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('onsId') %>
        <th>ONS ID</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('telephoneNumberContact1') %>
        <th>Personal Mobile Numer</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('telephoneNumberContact2') %>
        <th>Personal Home Number</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('status') %>
        <th>Status</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('idBadgeNo') %>
        <th>Badge No</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('personalEmailAddress') %>
        <th>Personal Email Address</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('postcode') %>
        <th>Postcode</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('country') %>
        <th>Country</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('emergencyContactFirstName') %>
        <th>Emergency Contact 1 - First Name</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('emergencyContactSurname') %>
        <th>Emergency Contact 1 - Second Name</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('emergencyContactMobileNo') %>
        <th>Emergency Contact 1 - Mobile No</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('emergencyContactFirstName2') %>
        <th>Emergency Contact 2 - First Name</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('emergencyContactSurname2') %>
        <th>Emergency Contact 2 - Second Name</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('emergencyContactMobileNo2') %>
        <th>Emergency Contact 2- Mobile No</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('anyLanguagesSpoken') %>
        <th>Languages Spoken</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('mobility') %>
        <th>Mobility</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('weeklyHours') %>
        <th>Weekly Hours</th>
      <% end %>
      <% if field_worker_history_table[0].has_key?('mobileStaff') %>
        <th>Mobile Staff</th>
      <% end %>
    </tr>
    </thead>
    <tbody>
    <% field_worker_history_table.each_with_index do |field_worker_history| %>
      <tr>
        <% if field_worker_history['ingestDate'].present? %>
          <% ingestDateTime = field_worker_history['ingestDate'].to_s  %>
          <% formattedStartDate = DateTime.parse(ingestDateTime).strftime("%d-%m-%Y %T") %>
          <td><%=h formattedStartDate %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['uniqueEmployeeId'].present? %>
          <td><%= h field_worker_history['uniqueEmployeeId'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['firstName'].present? %>
          <td><%= h field_worker_history['firstName'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['preferredName'].present? %>
          <td><%= h field_worker_history['preferredName'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['surname'].present? %>
          <td><%= h field_worker_history['surname'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['onsId'].present? %>
          <td><%= h field_worker_history['onsId'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['telephoneNumberContact1'].present? %>
          <td><%= h field_worker_history['telephoneNumberContact1'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['telephoneNumberContact2'].present? %>
          <td><%= h field_worker_history['telephoneNumberContact2'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['status'].present? %>
          <td><%= h field_worker_history['status'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['idBadgeNo'].present? %>
          <td><%= h field_worker_history['idBadgeNo'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['personalEmailAddress'].present? %>
          <td><%= h field_worker_history['personalEmailAddress'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['postcode'].present? %>
          <td><%= h field_worker_history['postcode'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['country'].present? %>
          <td><%= h field_worker_history['country'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['emergencyContactFirstName'].present? %>
          <td><%= h field_worker_history['emergencyContactFirstName'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['emergencyContactSurname'].present? %>
          <td><%= h field_worker_history['emergencyContactSurname'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['emergencyContactMobileNo'].present? %>
          <td><%= h field_worker_history['emergencyContactMobileNo'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['emergencyContactFirstName2'].present? %>
          <td><%= h field_worker_history['emergencyContactFirstName2'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['emergencyContactSurname2'].present? %>
          <td><%= h field_worker_history['emergencyContactSurname2'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['emergencyContactMobileNo2'].present? %>
          <td><%= h field_worker_history['emergencyContactMobileNo2'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['anyLanguagesSpoken'].present? %>
          <td><%= h field_worker_history['anyLanguagesSpoken'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['mobility'].present? %>
          <td><%= h field_worker_history['mobility'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['weeklyHours'].present? %>
          <td><%= h field_worker_history['weeklyHours'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if field_worker_history['mobileStaff'].present? %>
          <% if field_worker_history['mobileStaff'] == false %>
          <td>Yes</td>
          <% else %>
          <td>No</td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
<% else %>
  No History for Field Worker
<% end %>
<br>
<% if field_worker_job_roles.any? && @is_active_present == false %>
  Job Role History for Field Worker
  <table class="primary">
    <thead>
      <tr>
      <% if field_worker_job_roles[0].has_key?('contractStartDate') %>
        <th>Operational Start Date</th>
      <% end %>
      <% if field_worker_job_roles[0].has_key?('operationalEndDate') %>
        <th>Operational End Date</th>
      <% end %>
      <% if field_worker_job_roles[0].has_key?('uniqueRoleId') %>
        <th>Job Role ID</th>
      <% end %>
      <% if field_worker_job_roles[0].has_key?('jobRole') %>
        <th>Job Role</th>
      <% end %>
      <% if field_worker_job_roles[0].has_key?('areaLocation') %>
        <th>Area</th>
      <% end %>
      <% if field_worker_job_roles[0].has_key?('assignmentStatus') %>
        <th>Assignment Status</th>
      <% end %>
      </tr>
    </thead>
    <tbody>
    <% field_worker_job_roles.each_with_index do |jobroles| %>
    <tr>
      <% if jobroles['active'] ==  false %>
        <% if jobroles['contractStartDate'].present? %>
          <% contrStartDateTime = jobroles['contractStartDate'].to_s  %>
          <% formattedStartDate = Date.parse(contrStartDateTime).strftime("%d-%m-%Y") %>
          <td><%=h formattedStartDate %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if jobroles['operationalEndDate'].present? %>
          <% contrEndDateTime = jobroles['operationalEndDate'].to_s  %>
          <% formattedEndDate = Date.parse(contrEndDateTime).strftime("%d-%m-%Y") %>
          <td><%=h formattedEndDate %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if jobroles['uniqueRoleId'].present? %>
          <td><%=h jobroles['uniqueRoleId'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if jobroles['jobRole'].present? %>
          <td><%=h jobroles['jobRole'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if jobroles['areaLocation'].present? %>
          <td><%=h jobroles['areaLocation'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
        <% if jobroles['assignmentStatus'].present? %>
          <td><%=h jobroles['assignmentStatus'] %></td>
        <% else %>
          <td>-</td>
        <% end %>
      <% end %>
      </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  Field Worker has no Job Role History
<% end %>